From feb235e0812d6c5f1fda9e8c790b5bcb78aba285 Mon Sep 17 00:00:00 2001
From: Theodore Ts'o <tytso@mit.edu>
Date: Fri, 24 Aug 2018 17:12:20 -0400
Subject: [PATCH] For --enable-subset, change "make install" so it implies
 "make install-libs"

The e2fsprogs-libs-1.44.x.tar.gz subset distribution had a hack so
that "make install" would install the libraries via an implied "make
install-libs" --- since after all the tarball had was just the
libraries.

This commit makes "make install" behave the same was as the
e2fsprogs-libs distribution in the case of "configure --enable-subset"

Signed-off-by: Theodore Ts'o <tytso@mit.edu>
---
 Makefile.in  | 2 +-
 configure    | 4 ++++
 configure.ac | 3 +++
 3 files changed, 8 insertions(+), 1 deletion(-)

diff --git a/Makefile.in b/Makefile.in
index 80ab29941..462731452 100644
--- a/Makefile.in
+++ b/Makefile.in
@@ -64,7 +64,7 @@ distclean-doc:
 
 install: subs all-libs-recursive install-progs-recursive \
   install-shlibs-libs-recursive install-doc-libs
-	if test ! -d e2fsck && test ! -d debugfs && test ! -d misc && test ! -d ext2ed ; then $(MAKE) install-libs ; fi
+@SUBSET_CMT@	$(MAKE) install-libs
 
 install-strip: subs all-libs-recursive install-strip-progs-recursive \
   install-shlibs-strip-libs-recursive install-doc-libs
diff --git a/configure b/configure
index b9ce7b9f0..1ac065413 100755
--- a/configure
+++ b/configure
@@ -741,6 +741,7 @@ DEFRAG_CMT
 RESIZER_CMT
 IMAGER_CMT
 DEBUGFS_CMT
+SUBSET_CMT
 ALL_CMT
 BLKID_CMT
 DEPPROFILED_LIBBLKID
@@ -5644,10 +5645,12 @@ fi
 
 
 ALL_CMT=
+SUBSET_CMT=
 # Check whether --enable-subset was given.
 if test "${enable_subset+set}" = set; then :
   enableval=$enable_subset; if test "$enableval" = "no"
 then
+	SUBSET_CMT=#
 	{ $as_echo "$as_me:${as_lineno-$LINENO}: result: Disabling subset-only build" >&5
 $as_echo "Disabling subset-only build" >&6; }
 else
@@ -5660,6 +5663,7 @@ fi
 
 
 
+
 # Check whether --enable-backtrace was given.
 if test "${enable_backtrace+set}" = set; then :
   enableval=$enable_backtrace; if test "$enableval" = "no"
diff --git a/configure.ac b/configure.ac
index f365cfa6d..51a446d72 100644
--- a/configure.ac
+++ b/configure.ac
@@ -568,10 +568,12 @@ dnl
 dnl handle --enable-subset
 dnl
 ALL_CMT=
+SUBSET_CMT=
 AC_ARG_ENABLE([subset],
 [  --enable-subset  	  enable subset-only build],
 if test "$enableval" = "no"
 then
+	SUBSET_CMT=#
 	AC_MSG_RESULT([Disabling subset-only build])
 else
 	ALL_CMT=#
@@ -579,6 +581,7 @@ else
 fi
 ,)
 AC_SUBST(ALL_CMT)
+AC_SUBST(SUBSET_CMT)
 dnl
 dnl handle --disable-backtrace
 dnl
